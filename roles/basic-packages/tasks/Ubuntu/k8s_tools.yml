- name: check if kubectl exists
  stat:
    path: /usr/local/bin/kubectl
  register: kubectl

- name: Get the lastest version of kubectl
  uri:
    url: https://storage.googleapis.com/kubernetes-release/release/stable.txt
    return_content: yes    
  register: kubectl_version 

- name: Download kubectl
  get_url:
    url: "https://storage.googleapis.com/kubernetes-release/release/{{ kubectl_version.content| replace('\n','') }}/bin/linux/amd64/kubectl"
    dest: /usr/local/bin/kubectl
    mode: 0755
  when: kubectl.stat.exists == false